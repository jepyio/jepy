var jepy=function(){"use strict";class t{render(){}}class e extends t{#t;#e;#s;constructor(t,e,s){super(),this.#t=t,this.#e=e,this.#s=s}render(t){return this.#t(t)?this.#e.render(t):this.#s?this.#s.render(t):""}}const s=".",n=":",r=(t,e)=>t.includes(s)?t.split(s).reduce((t,e)=>t?.[e],e):e[t];class i extends t{#n;#r;#i;#c;constructor(t,e,s,n=""){super(),this.#n=t,this.#i=e,this.#c=s,this.#r=n}render(t){let e=r(this.#n,t);const s=e.length,n=s-1;return e.map((e,r)=>{this.#r&&(e={[this.#r]:e}),this.#c&&(e=this.#c(e,t));let i=Object.assign({},t,e);return i.loop={index:r,first:0===r,last:r===n,number:r+1,size:s},this.#i.render(i)}).join("")}}class c extends t{#o;#h;#a=null;constructor(t,e){super(),this.#o=t,this.#h=e||(()=>!0)}render(t){return null!==this.#a&&this.#h(t,this)||(this.#a=this.#o.render(t)),this.#a}}const o={SPACE:" ",TAB:"\t"};class h extends t{#l;#u;#d;constructor(t,e,s){super(),this.#l=t,this.#u=e,this.#d=s}render(t){const e=String().padStart(this.#d,this.#u),s=this.#l.render(t);return s.includes("\n")?e+s.replace(new RegExp("\\n","g"),"\n"+e):e+s}}const a="$",l="%",u={REPEATING:"#",CONDITIONAL:"?",TAB_INDENTED:">",SPACE_INDENTED:"_",CACHED:"="},d="{",p="}",b="",f="!",k="@";class g{#p="";#b={};#f=!1;constructor(t,e={}){this.#p=t,this.#b=e}render(t={}){if(!this.#p)return"";this.#f||this.#k();let e=this.#p;const s=(t,s)=>{const n=new RegExp("(?<indent>[ \\t]*)\\"+t+"\\"+d+"(?<path>[^\\"+p+"]*)\\"+p,"gm"),r=e.matchAll(n);for(const t of r){const n=s(t.groups.path);e=e.replaceAll(t[0],this.#g(n,t.groups.indent))}};return s(l,e=>this.#w(e,t)),s(a,e=>{const s=this.#w(e,t);return"string"==typeof s?this.#x(s):s}),e}#g(t,e){return e?"string"==typeof t&&t.includes("\n")?e+t.replace(new RegExp("\\n","g"),"\n"+e):e+t:t}#w(t,e){return t.startsWith(k)?this.#C(t,e):r(t,e)}#C(e,s){const n=e.slice(1);let i=r(n,this.#b);"function"==typeof i&&(i=i(s));return"object"==typeof i&&i instanceof t?i.render(s):i}#x(t){return t.replace(/([<>&]|[^#-~| |!])/g,t=>"&#"+t.charCodeAt(0)+";").replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,t=>"&#"+(1024*t.charCodeAt(0)+t.charCodeAt(1)-56613888)+";")}#k(){const t=Object.values(u).map(t=>"\\"+t),e=new RegExp("(?<prefix>["+t.join("")+"])\\"+d+"(?<operator>[\\"+f+"])?(?<placeholder>(?<name>[^\\"+n+"\\"+p+"]*)(?:\\"+n+"[^\\"+p+"]+)?)\\"+p+"(?<content>(.|\n)*?)\\k<prefix>\\"+d+"\\/\\k<name>\\"+p,"gm");let s=0,r=[],i={};for(;(r=Array.from(this.#p.matchAll(e))).length>0;){const t=r[0],e="block_"+s;s++;const n=l+d+k+e+p;this.#p=this.#p.replace(t[0],n),i[e]=this.#E(t)}this.#b=Object.assign(this.#b,i),this.#f=!0}#E(t){const s=t.groups.prefix,r=t.groups.placeholder,a=Object.assign({},this.#b);switch(s){case u.CONDITIONAL:return s=>{let n=t.groups.content,i="";const c=t.groups.operator===f,o=u.CONDITIONAL+d+(c?b:f)+r+p;if(n.includes(o)){const t=n.split(o);n=t[0],i=t[1]}return new e(()=>{const t=this.#w(r,s),e=!t||Object.hasOwn(t,"length")&&0===t.length||"object"==typeof t&&0===Object.keys(t).length;return e&&c||!e&&!c},new g(n,a),new g(i,a))};case u.REPEATING:return()=>{const e=r.split(n),s=e.at(0),c=r.includes(n)?e.at(1):"";return new i(s,new g(t.groups.content,a),t=>t,c)};case u.TAB_INDENTED:case u.SPACE_INDENTED:return()=>{const e=r.includes(n)?parseInt(r.split(n).at(1)):0;return new h(new g(t.groups.content,a),s===u.TAB_INDENTED?o.TAB:o.SPACE,e)};case u.CACHED:return()=>{const e="cached_"+r.split(n).at(0);return Object.hasOwn(this.#b,e)||(this.#b[e]=new c(new g(t.groups.content,a))),this.#b[e]};default:throw new SyntaxError('unhandled prefix "'+s+'"')}}}return{Block:t,Composite:class extends t{#m;constructor(t){super(),this.#m=t}render(t){return this.#m.map(e=>e.render(t)).join("")}},Conditional:e,Repeating:i,Simple:class extends t{#p;constructor(t){super(),this.#p=t}render(){return this.#p}},Callback:class extends t{#O;constructor(t){super(),this.#O=t}render(t){return this.#O(t)}},Cached:c,IndentType:o,Indented:h,Template:g}}();