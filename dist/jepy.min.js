var jepy=function(){"use strict";class t{render(){}}class e extends t{#t;#e;#s;constructor(t,e,s){super(),this.#t=t,this.#e=e,this.#s=s}render(t){return this.#t(t)?this.#e.render(t):this.#s?this.#s.render(t):""}}const s=".",n=":",r=(t,e)=>t.includes(s)?t.split(s).reduce((t,e)=>t?.[e],e):e[t];class c extends t{#n;#r;#c;#i;constructor(t,e,s,n=""){super(),this.#n=t,this.#c=e,this.#i=s,this.#r=n}render(t){let e=r(this.#n,t);const s=e.length,n=s-1;return e.map((e,r)=>{this.#r&&(e={[this.#r]:e}),this.#i&&(e=this.#i(e,t));let c=Object.assign({},t,e);return c.loop={index:r,first:0===r,last:r===n,number:r+1,size:s},this.#c.render(c)}).join("")}}class i extends t{#h;constructor(t){super(),this.#h=t}render(){return this.#h}}class h extends t{#o;#a;#l=null;#u={};constructor(t,e){super(),this.#o=t,this.#a=e||(()=>!0)}render(t){return null!==this.#l&&this.#a(t,this.#u)||(this.#l=this.#o.render(t)),this.#u=t,this.#l}}const o={SPACE:" ",TAB:"\t"};class a extends t{#d;#p;#b;constructor(t,e,s){super(),this.#d=t,this.#p=e,this.#b=s}render(t){const e=String().padStart(this.#b,this.#p);return this.#d.render(t).replace(new RegExp("^","gm"),e)}}const l={ESCAPED:"$",RAW:"%"},u={REPEATING:"#",CONDITIONAL:"?",TAB_INDENTED:">",SPACE_INDENTED:"_",CACHED:"="},d="{",p="}",b="",k="!",w="@";class x{#h="";#k={};constructor(t,e={}){this.#h=t,this.#k=e,this.#w()}render(t={}){let e=this.#h;const s=new RegExp("(?<indent>[ \\t]*)(?<placeholder>(?<prefix>[\\"+Object.values(l).join("\\")+"])\\"+d+"(?<path>[^\\"+p+"]*)\\"+p+")","m");let n;for(;n=s.exec(e);){let s=this.#x(n.groups.path,t);"string"==typeof s&&(n.groups.prefix===l.ESCAPED&&(s=this.#f(s)),n.groups.indent&&s.includes("\n")&&(s=s.replace(new RegExp("\\n","g"),"\n"+n.groups.indent))),e=e.replaceAll(n.groups.placeholder,s)}return e}#x(t,e){return t.startsWith(w)?this.#C(t,e):r(t,e)}#C(e,s){const n=e.slice(1);let c=r(n,this.#k);"function"==typeof c&&(c=c(s));return"object"==typeof c&&c instanceof t?c.render(s):c}#f(t){return t.replace(/([<>&]|[^#-~| |!])/g,t=>"&#"+t.charCodeAt(0)+";").replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,t=>"&#"+(1024*t.charCodeAt(0)+t.charCodeAt(1)-56613888)+";")}#w(){const t=new RegExp("(?<prefix>[\\"+Object.values(u).join("\\")+"])\\"+d+"(?<operator>[\\"+k+"])?(?<placeholder>(?<name>[^\\"+n+"\\"+p+"]*)(?:\\"+n+"[^\\"+p+"]+)?)\\"+p+"(?<content>(.|\n)*?)\\k<prefix>\\"+d+"\\/\\k<name>\\"+p,"m");let e=0,s=[],r={};for(;s=t.exec(this.#h);){const t="block_"+e;e++;const n=l.RAW+d+w+t+p;this.#h=this.#h.replace(s[0],n),r[t]=this.#E(s)}this.#k=Object.assign(this.#k,r)}#E(t){const s=t.groups.prefix,l=t.groups.placeholder,f=Object.assign({},this.#k);switch(s){case u.CONDITIONAL:return s=>{let n=t.groups.content,r=new i("");const c=t.groups.operator===k,h=u.CONDITIONAL+d+(c?b:k)+l+p;if(n.includes(h)){const t=n.split(h);n=t[0],r=new x(t[1],f)}return new e(()=>{const t=this.#x(l,s),e=!t||Object.hasOwn(t,"length")&&0===t.length||"object"==typeof t&&0===Object.keys(t).length;return e&&c||!e&&!c},new x(n,f),r)};case u.REPEATING:return()=>{const e=l.split(n),s=e.at(0),r=l.includes(n)?e.at(1):"";return new c(s,new x(t.groups.content,f),t=>t,r)};case u.TAB_INDENTED:case u.SPACE_INDENTED:return()=>{const e=l.includes(n)?parseInt(l.split(n).at(1)):0;return new a(new x(t.groups.content,f),s===u.TAB_INDENTED?o.TAB:o.SPACE,e)};case u.CACHED:return()=>{const e=l.split(n),s="cached_"+e.at(0),c=l.includes(n)?(t,s)=>{const n=e.at(1);return n.startsWith(w)?r(n.slice(1),this.#k)(t,s):r(n,t)}:()=>!0;return Object.hasOwn(this.#k,s)||(this.#k[s]=new h(new x(t.groups.content,f),c)),this.#k[s]};default:throw new SyntaxError('unhandled prefix "'+s+'"')}}}return{Block:t,Composite:class extends t{#g;constructor(t){super(),this.#g=t}render(t){return this.#g.map(e=>e.render(t)).join("")}},Conditional:e,Repeating:c,Simple:i,Callback:class extends t{#m;constructor(t){super(),this.#m=t}render(t){return this.#m(t)}},Cached:h,IndentType:o,Indented:a,Template:x}}();